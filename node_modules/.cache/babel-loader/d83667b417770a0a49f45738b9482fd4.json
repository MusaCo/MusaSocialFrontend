{"ast":null,"code":"import _toConsumableArray from\"C:/Users/musli/Desktop/mern MusaSocial/React/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/Users/musli/Desktop/mern MusaSocial/React/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/musli/Desktop/mern MusaSocial/React/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/musli/Desktop/mern MusaSocial/React/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import'./messenger.css';import Topbar from\"../../components/topbar/Topbar\";import Conversation from\"../../components/conversation/Conversation\";import Message from\"../../components/Message/Message\";import ChatOnline from\"../../components/chatOnline/ChatOnline\";import{useContext,useState,useEffect,useRef}from'react';import{AuthContext}from'../../context/AuthContext';import axios from\"axios\";import{io}from\"socket.io-client\";import{Redirect}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function Messenger(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),conversations=_useState2[0],setconversations=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),currentChat=_useState4[0],setcurrentChat=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),newMessage=_useState6[0],setnewMessage=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),messages=_useState8[0],setmessages=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),arrivalMessage=_useState10[0],setarrivalMessage=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),onlineUsers=_useState12[0],setonlineUsers=_useState12[1];var Socket=useRef();var scrollRef=useRef();var _useState13=useState(true),_useState14=_slicedToArray(_useState13,2),isLoggedin=_useState14[0],setisLoggedin=_useState14[1];var _useContext=useContext(AuthContext),user=_useContext.user,dispatch=_useContext.dispatch;useEffect(function(){var checkifLoggedin=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch({type:\"LOGIN_START\"});_context.prev=1;_context.next=4;return axios.get(\"/auth/login\");case 4:res=_context.sent;if(res.data.Loggedin===true){dispatch({type:\"LOGIN_SUCCESS\",payload:res.data.message});setisLoggedin(true);}else{setisLoggedin(false);}_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);setisLoggedin(false);dispatch({type:\"LOGIN_FAILURE\",payload:_context.t0});case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function checkifLoggedin(){return _ref.apply(this,arguments);};}();checkifLoggedin();},[]);useEffect(function(){if(isLoggedin){var getConversations=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.get(\"/conversations/\"+(user===null||user===void 0?void 0:user._id));case 3:res=_context2.sent;setconversations(res.data);_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));return function getConversations(){return _ref2.apply(this,arguments);};}();getConversations();}},[user===null||user===void 0?void 0:user._id]);useEffect(function(){if(isLoggedin){Socket.current=io(\"ws://localhost:8900\");Socket.current.on(\"getMessage\",function(data){setarrivalMessage({sender:data.senderId,text:data.text,createdAt:Date.now()});});}},[]);useEffect(function(){if(isLoggedin){Socket.current.emit(\"addUser\",user===null||user===void 0?void 0:user._id);Socket.current.on(\"getUsers\",function(users){setonlineUsers(user===null||user===void 0?void 0:user.followings.filter(function(f){return users.some(function(u){return u.userId===f;});}));console.log(users);});}},[user]);useEffect(function(){if(isLoggedin){arrivalMessage&&(currentChat===null||currentChat===void 0?void 0:currentChat.members.includes(arrivalMessage.sender))&&setmessages(function(prev){return[].concat(_toConsumableArray(prev),[arrivalMessage]);});}},[arrivalMessage,currentChat]);useEffect(function(){if(isLoggedin){var getMessages=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return axios.get(\"/messages/\"+(currentChat===null||currentChat===void 0?void 0:currentChat._id));case 3:res=_context3.sent;setmessages(res.data);_context3.next=10;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[0,7]]);}));return function getMessages(){return _ref3.apply(this,arguments);};}();getMessages();}},[currentChat]);var handleSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e){var message,receiverId,res;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:e.preventDefault();message={sender:user===null||user===void 0?void 0:user._id,text:newMessage,conversationId:currentChat._id};receiverId=currentChat.members.find(function(member){return member!==(user===null||user===void 0?void 0:user._id);});Socket.current.emit(\"sendMessage\",{senderId:user===null||user===void 0?void 0:user._id,receiverId:receiverId,text:newMessage});setnewMessage(\"\");_context4.prev=5;_context4.next=8;return axios.post(\"/messages\",message);case 8:res=_context4.sent;setmessages([].concat(_toConsumableArray(messages),[res.data]));_context4.next=15;break;case 12:_context4.prev=12;_context4.t0=_context4[\"catch\"](5);console.log(_context4.t0);case 15:case\"end\":return _context4.stop();}}},_callee4,null,[[5,12]]);}));return function handleSubmit(_x){return _ref4.apply(this,arguments);};}();useEffect(function(){var _scrollRef$current;(_scrollRef$current=scrollRef.current)===null||_scrollRef$current===void 0?void 0:_scrollRef$current.scrollIntoView({behavior:\"smooth\"});},[messages]);if(!isLoggedin){return/*#__PURE__*/_jsx(Redirect,{to:\"/login\"});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Topbar,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"messenger\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chatMenu\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chatMenuWrapper\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Search for Friends\",className:\"chatMenuInput\"}),conversations.map(function(c){return/*#__PURE__*/_jsx(\"div\",{className:\"\",onClick:function onClick(){return setcurrentChat(c);},children:/*#__PURE__*/_jsx(Conversation,{conversation:c,currentUser:user})});})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"chatBox\",children:/*#__PURE__*/_jsx(\"div\",{className:\"chatBoxWrapper\",children:currentChat?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"chatBoxTop\",children:messages.map(function(m){return/*#__PURE__*/_jsx(\"div\",{ref:scrollRef,children:/*#__PURE__*/_jsx(Message,{own:(m===null||m===void 0?void 0:m.sender)===(user===null||user===void 0?void 0:user._id),message:m})});})}),/*#__PURE__*/_jsxs(\"div\",{className:\"chatBoxBottom\",children:[/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Write Something...\",className:\"chatMessageInput\",onChange:function onChange(e){return setnewMessage(e.target.value);},value:newMessage}),/*#__PURE__*/_jsx(\"button\",{className:\"chatSubmitButton\",onClick:handleSubmit,children:\"Send\"})]})]}):/*#__PURE__*/_jsx(\"span\",{className:\"noConversationText\",children:\"Open a Convo to start Chatting\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"chatOnline\",children:/*#__PURE__*/_jsx(\"div\",{className:\"chatOnlineWrapper\",children:/*#__PURE__*/_jsx(ChatOnline,{onlineusers:onlineUsers,currentId:user===null||user===void 0?void 0:user._id,setcurrentChat:setcurrentChat})})})]})]});}","map":{"version":3,"sources":["C:/Users/musli/Desktop/mern MusaSocial/React/src/pages/messenger/Messenger.jsx"],"names":["Topbar","Conversation","Message","ChatOnline","useContext","useState","useEffect","useRef","AuthContext","axios","io","Redirect","Messenger","conversations","setconversations","currentChat","setcurrentChat","newMessage","setnewMessage","messages","setmessages","arrivalMessage","setarrivalMessage","onlineUsers","setonlineUsers","Socket","scrollRef","isLoggedin","setisLoggedin","user","dispatch","checkifLoggedin","type","get","res","data","Loggedin","payload","message","getConversations","_id","console","log","current","on","sender","senderId","text","createdAt","Date","now","emit","users","followings","filter","f","some","u","userId","members","includes","prev","getMessages","handleSubmit","e","preventDefault","conversationId","receiverId","find","member","post","scrollIntoView","behavior","map","c","m","target","value"],"mappings":"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","sourcesContent":["import './messenger.css'\r\nimport Topbar from \"../../components/topbar/Topbar\";\r\nimport Conversation from \"../../components/conversation/Conversation\";\r\nimport Message from \"../../components/Message/Message\";\r\nimport ChatOnline from \"../../components/chatOnline/ChatOnline\";\r\nimport { useContext, useState, useEffect, useRef } from 'react';\r\nimport { AuthContext } from '../../context/AuthContext';\r\nimport axios from \"axios\"\r\nimport { io } from \"socket.io-client\";\r\nimport { Redirect } from 'react-router-dom';\r\n\r\nexport default function Messenger() {\r\n    const [conversations, setconversations] = useState([])\r\n    const [currentChat, setcurrentChat] = useState(null)\r\n    const [newMessage, setnewMessage] = useState(null)\r\n    const [messages, setmessages] = useState(null)\r\n    const [arrivalMessage, setarrivalMessage] = useState(null)\r\n    const [onlineUsers, setonlineUsers] = useState([])\r\n    const Socket = useRef()\r\n    const scrollRef = useRef()\r\n    const [isLoggedin, setisLoggedin] = useState(true)\r\n    const{user, dispatch} = useContext(AuthContext);\r\n    \r\n    useEffect(() => {\r\n        const checkifLoggedin = async () =>{\r\n            dispatch({type: \"LOGIN_START\"});\r\n            try {\r\n                const res = await axios.get(\"/auth/login\");\r\n                if (res.data.Loggedin === true) {\r\n                    \r\n                    dispatch({type: \"LOGIN_SUCCESS\", payload: res.data.message});\r\n                    setisLoggedin(true)\r\n                }\r\n                else{\r\n                    setisLoggedin(false);\r\n                }\r\n            } \r\n            catch (error) {\r\n                setisLoggedin(false);\r\n                dispatch({type: \"LOGIN_FAILURE\", payload: error});    \r\n             }\r\n            }\r\n        checkifLoggedin();\r\n        \r\n    }, [])\r\n\r\n    \r\n    useEffect(() => {\r\n        if (isLoggedin) {\r\n            const getConversations = async () =>{\r\n                try {\r\n                    const res = await axios.get(\"/conversations/\" + user?._id)\r\n                    setconversations(res.data)\r\n                }\r\n                catch (error) {\r\n                    console.log(error)\r\n                }\r\n            }\r\n            getConversations();\r\n        }\r\n        \r\n    }, [user?._id])\r\n\r\n    useEffect(() => {\r\n        if (isLoggedin) {\r\n            Socket.current = io(\"ws://localhost:8900\");\r\n            Socket.current.on(\"getMessage\", data => {\r\n            setarrivalMessage({\r\n                sender: data.senderId,\r\n                text: data.text,\r\n                createdAt: Date.now(),\r\n            })\r\n        })\r\n        }\r\n    }, [])\r\n    \r\n    useEffect(() => {\r\n        if (isLoggedin) {\r\n            Socket.current.emit(\"addUser\", user?._id)\r\n            Socket.current.on(\"getUsers\", (users) => {setonlineUsers(user?.followings.filter((f) => users.some((u) => u.userId === f))); console.log(users)})\r\n        }\r\n        \r\n    }, [user])\r\n    \r\n    useEffect(() => {\r\n        if (isLoggedin) {\r\n            arrivalMessage && currentChat?.members.includes(arrivalMessage.sender) && setmessages((prev) => [...prev, arrivalMessage])\r\n        }\r\n    }, [arrivalMessage, currentChat])\r\n\r\n    useEffect(() => {\r\n        if (isLoggedin) {\r\n            const getMessages = async () =>{\r\n                try {\r\n                    const res = await axios.get(\"/messages/\" + currentChat?._id)\r\n                    setmessages(res.data)\r\n                } \r\n                catch (error) {\r\n                    console.log(error)\r\n                }\r\n            }\r\n            getMessages();\r\n        }\r\n        \r\n\r\n    },[currentChat])\r\n\r\n   \r\n\r\n    const handleSubmit = async (e) =>{\r\n        e.preventDefault();\r\n        const message = {\r\n            sender: user?._id,\r\n            text: newMessage,\r\n            conversationId: currentChat._id\r\n        }\r\n        \r\n        const receiverId = currentChat.members.find(member => member !== user?._id)\r\n        Socket.current.emit(\"sendMessage\", \r\n        {   \r\n            senderId: user?._id, \r\n            receiverId: receiverId, \r\n            text: newMessage\r\n        })\r\n        setnewMessage(\"\");\r\n        try {\r\n            const res = await axios.post(\"/messages\", message)\r\n            setmessages([...messages , res.data])\r\n        } \r\n        catch (error) {\r\n            console.log(error)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        scrollRef.current?.scrollIntoView({behavior: \"smooth\"})\r\n    }, [messages])\r\n\r\n    if (!isLoggedin) {\r\n        return <Redirect to=\"/login\" />\r\n    }\r\n\r\n    \r\n    return (\r\n        <>\r\n        <Topbar/>\r\n        <div className=\"messenger\">\r\n            <div className=\"chatMenu\">\r\n                <div className=\"chatMenuWrapper\">\r\n                    <input placeholder=\"Search for Friends\" className=\"chatMenuInput\" />\r\n                    {\r\n                        conversations.map((c) => (\r\n                            <div className=\"\" onClick={() => setcurrentChat(c)}>\r\n                                <Conversation conversation={c} currentUser={user}/>\r\n                            </div>\r\n                            \r\n                        ))\r\n                    }\r\n                </div>\r\n            </div>\r\n            <div className=\"chatBox\">\r\n                <div className=\"chatBoxWrapper\">\r\n                    {\r\n                        currentChat?<><div className=\"chatBoxTop\">\r\n                            \r\n                        {\r\n                            messages.map((m) => (\r\n                                <div ref={scrollRef}>\r\n                                    <Message own={m?.sender === user?._id} message={m} />\r\n                                </div>\r\n                                \r\n                            ))\r\n                        }\r\n                        \r\n                    </div>\r\n                    <div className=\"chatBoxBottom\">\r\n                    <textarea placeholder=\"Write Something...\" className=\"chatMessageInput\" onChange={(e) => setnewMessage(e.target.value)} value={newMessage}></textarea>\r\n                    <button className=\"chatSubmitButton\" onClick={handleSubmit}>Send</button>\r\n                    </div>\r\n                    </>\r\n                    : <span className=\"noConversationText\">Open a Convo to start Chatting</span>\r\n                    }\r\n                    \r\n                </div>\r\n            </div>\r\n            <div className=\"chatOnline\">\r\n                <div className=\"chatOnlineWrapper\">\r\n                    <ChatOnline onlineusers={onlineUsers} currentId={user?._id} setcurrentChat={setcurrentChat}/>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        </>\r\n    )\r\n    \r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}